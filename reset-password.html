<!DOCTYPE html>
<html>
<head>
  <title>Reset Your Password - RhymeIt</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <h2>Reset Your Password</h2>
  <p id="status"></p>

  <div id="form" style="display: none;">
    <input type="password" id="new-password" placeholder="New Password" />
    <button onclick="submitNewPassword()">Reset Password</button>
  </div>

 <script>
  const status = document.getElementById("status");
  const form = document.getElementById("form");

  const client = window.supabase.createClient(
    "https://nsojytwpnnsxwumfnsfl.supabase.co",
    "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5zb2p5dHdwbm5zeHd1bWZuc2ZsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDA1MTY5MjIsImV4cCI6MjA1NjA5MjkyMn0.0D7Hs7BJWZrgVI7oKTOC4h3ctaQ7uUUeIx0YuKvSuKI"
  );

  let accessToken = null;

  async function init() {
    const url = new URL(window.location.href);
    accessToken = url.searchParams.get("access_token");
    const type = url.searchParams.get("type");

    if (!accessToken || type !== "recovery") {
      status.textContent = "Invalid or expired reset link.";
      return;
    }

    // Confirm the token is valid by fetching the user
    const { data, error } = await client.auth.getUser(accessToken);
    if (error) {
      status.textContent = "Error verifying token: " + error.message;
      console.error("Token check error:", error);
      return;
    }

    form.style.display = "block";
  }

  async function submitNewPassword() {
    const newPassword = document.getElementById("new-password").value;
    if (!newPassword) {
      status.textContent = "Please enter a new password.";
      return;
    }

    const { error } = await client.auth.updateUser(
      { password: newPassword },
      { accessToken: accessToken }
    );

    if (error) {
      status.textContent = "Error updating password: " + error.message;
    } else {
      status.textContent = "âœ… Password updated! You can close this tab and log in.";
      form.style.display = "none";
    }
  }

  init();
</script>


</body>
</html>
